{% extends "base.html" %}
{% block title %}Container Detail{% endblock %}
{% block content %}
<div class="container">
  <h2>Container: {{ container.container_name }}</h2>
  <div class="container-info">
    <p><strong>Username:</strong> {{ container.username }}</p>
    <p><strong>IP Address:</strong> {{ container.ip_address }}</p>
    <p><strong>Status:</strong>
      {% if container.status == 'running' %}
        <span class="status-dot running"></span> Running
      {% elif container.status == 'stopped' %}
        <span class="status-dot stopped"></span> Stopped
      {% else %}
        <span class="status-dot creating"></span> Creating
      {% endif %}
    </p>
    <p><strong>Created:</strong> {{ container.created_at }}</p>
    <p><strong>Resource Limits:</strong>
      CPU: {{ container.cpu_limit }} |
      Memory: {{ container.memory_limit // (1024*1024) }} MB |
      Disk: {{ container.disk_limit // (1024*1024) }} MB
    </p>
    <p><strong>Protocols:</strong>
      {% if container.enable_ssh %}<span title="SSH">ğŸ”’</span>{% endif %}
      {% if container.enable_socks5 %}<span title="SOCKS5">ğŸ§¦</span>{% endif %}
      {% if container.enable_http %}<span title="HTTP">ğŸŒ</span>{% endif %}
      {% if container.enable_wireguard %}<span title="WireGuard">ğŸ›¡ï¸</span>{% endif %}
    </p>
    <p><strong>Health:</strong>
      {% if container.health_status == 'healthy' %}
        <span class="health-dot healthy"></span> Healthy
      {% elif container.health_status == 'degraded' %}
        <span class="health-dot degraded"></span> Degraded
      {% else %}
        <span class="health-dot failed"></span> Failed
      {% endif %}
    </p>
    <p><strong>Bandwidth Used:</strong> {{ (container.bandwidth_in + container.bandwidth_out) // (1024*1024) }} MB</p>
  </div>
  <div class="resource-graphs">
    <canvas id="cpuChart"></canvas>
    <canvas id="memChart"></canvas>
    <canvas id="bwChart"></canvas>
  </div>
  <div class="service-status">
    <h3>Service Status</h3>
    <ul>
      <li>SSH (22): <span id="ssh-status"></span></li>
      <li>SOCKS5 (1080): <span id="socks5-status"></span></li>
      <li>HTTP (8080): <span id="http-status"></span></li>
      <li>WireGuard: <span id="wg-status"></span></li>
    </ul>
    <button class="btn" onclick="testService('ssh')">Test SSH</button>
    <button class="btn" onclick="testService('socks5')">Test SOCKS5</button>
    <button class="btn" onclick="testService('http')">Test HTTP</button>
    <button class="btn" onclick="testService('wireguard')">Test WireGuard</button>
  </div>
  <div class="connection-instructions">
    <h3>Connection Instructions</h3>
    <ul>
      {% if container.enable_ssh %}
      <li>SSH: <code>ssh -D 1080 {{ container.username }}@{{ container.ip_address }}</code></li>
      {% endif %}
      {% if container.enable_socks5 %}
      <li>SOCKS5: Server={{ container.ip_address }}, Port=1080, User={{ container.username }}, Pass=[generated]</li>
      {% endif %}
      {% if container.enable_http %}
      <li>HTTP: <code>http://{{ container.username }}:password@{{ container.ip_address }}:8080</code></li>
      {% endif %}
      {% if container.enable_wireguard %}
      <li>WireGuard: <a href="{{ url_for('download_wg_config', name=container.container_name) }}">Download Config</a></li>
      {% endif %}
    </ul>
  </div>
  <div class="actions">
    <form action="{{ url_for('start_container_route', name=container.container_name) }}" method="post" style="display:inline;">
      <button class="btn" type="submit">Start</button>
    </form>
    <form action="{{ url_for('stop_container_route', name=container.container_name) }}" method="post" style="display:inline;">
      <button class="btn" type="submit">Stop</button>
    </form>
    <form action="{{ url_for('delete_container_route', name=container.container_name) }}" method="post" style="display:inline;" onsubmit="return confirm('Delete this container?');">
      <button class="btn btn-danger" type="submit">Delete</button>
    </form>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script>
  // JS hooks for resource graphs and service status
  // (AJAX polling and Chart.js integration)
</script>
{% endblock %}
