{% extends "base.html" %}

{% block title %}User Details - {{ user.username }}{% endblock %}

{% block page_title %}User Details: {{ user.username }}{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- User Information -->
    <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4">User Information</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Username</label>
                <p class="mt-1 text-sm text-gray-900">{{ user.username }}</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">IP Address</label>
                <p class="mt-1 text-sm text-gray-900">{{ user.ip_address }}</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Created</label>
                <p class="mt-1 text-sm text-gray-900">{{ user.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Status</label>
                <span class="mt-1 px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                     {% if user.status == 'active' %}bg-green-100 text-green-800{% elif user.status == 'disabled' %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">
                    {{ user.status.title() }}
                </span>
            </div>
        </div>
    </div>

    <!-- Protocol Management -->
    <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4">Protocol Management</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="border rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">🔒 SSH</span>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                        <input type="checkbox" id="toggle_ssh" {% if user.enable_ssh %}checked{% endif %} title="Toggle SSH"
                               class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer">
                        <label for="toggle_ssh" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
                <div class="text-xs text-gray-600">
                    <strong>Connection:</strong><br>
                    <code class="bg-gray-100 p-1 rounded text-xs">ssh -D 1080 {{ user.username }}@{{ user.ip_address }}</code>
                </div>
            </div>

            <div class="border rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">🧦 SOCKS5</span>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                        <input type="checkbox" id="toggle_socks5" {% if user.enable_socks5 %}checked{% endif %} title="Toggle SOCKS5"
                               class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer">
                        <label for="toggle_socks5" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
                <div class="text-xs text-gray-600">
                    <strong>Server:</strong> {{ user.ip_address }}<br>
                    <strong>Port:</strong> {{ proxy_ports.socks5 }}<br>
                    <strong>User:</strong> {{ user.username }}<br>
                    <strong>Pass:</strong> {{ user.password }}
                </div>
                <button class="mt-2 text-xs bg-blue-500 text-white px-2 py-1 rounded test-connection-btn" data-protocol="socks5">
                    Test Connection
                </button>
            </div>

            <div class="border rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">🌐 HTTP</span>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                        <input type="checkbox" id="toggle_http" {% if user.enable_http %}checked{% endif %} title="Toggle HTTP"
                               class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer">
                        <label for="toggle_http" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
                <div class="text-xs text-gray-600">
                    <strong>Proxy:</strong><br>
                    <code class="bg-gray-100 p-1 rounded text-xs">http://{{ user.username }}:{{ user.password }}@{{ user.ip_address }}:{{ proxy_ports.http }}</code>
                </div>
                <button class="mt-2 text-xs bg-blue-500 text-white px-2 py-1 rounded test-connection-btn" data-protocol="http">
                    Test Connection
                </button>
            </div>

            <div class="border rounded-lg p-4">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">📡 PPTP</span>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none">
                        <input type="checkbox" id="toggle_pptp" {% if user.enable_pptp %}checked{% endif %} title="Toggle PPTP"
                               class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer">
                        <label for="toggle_pptp" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
                <div class="text-xs text-gray-600">
                    <strong>Server:</strong> {{ user.ip_address }}<br>
                    <strong>Username:</strong> {{ user.username }}<br>
                    <strong>Password:</strong> {{ user.password }}
                </div>
                <button class="mt-2 text-xs bg-blue-500 text-white px-2 py-1 rounded test-connection-btn" data-protocol="pptp">
                    Test Connection
                </button>
            </div>
        </div>
    </div>

    <!-- Real-time Status -->
    <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4">Real-time Status</h3>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="text-center">
                <div class="text-2xl mb-2">🔒</div>
                <div class="text-sm font-medium">SSH</div>
                <div class="text-xs text-gray-600">Always available</div>
            </div>
            <div class="text-center">
                <div class="text-2xl mb-2" id="socks5-status">
                    {% if proxy_status.get('socks5', False) %}🟢{% else %}🔴{% endif %}
                </div>
                <div class="text-sm font-medium">SOCKS5</div>
                <div class="text-xs text-gray-600" id="socks5-status-text">
                    {% if proxy_status.get('socks5', False) %}Running{% else %}Stopped{% endif %}
                </div>
            </div>
            <div class="text-center">
                <div class="text-2xl mb-2" id="http-status">
                    {% if proxy_status.get('http', False) %}🟢{% else %}🔴{% endif %}
                </div>
                <div class="text-sm font-medium">HTTP</div>
                <div class="text-xs text-gray-600" id="http-status-text">
                    {% if proxy_status.get('http', False) %}Running{% else %}Stopped{% endif %}
                </div>
            </div>
            <div class="text-center">
                <div class="text-2xl mb-2">📡</div>
                <div class="text-sm font-medium">PPTP</div>
                <div class="text-xs text-gray-600">VPN Service</div>
            </div>
        </div>
    </div>

    <!-- Danger Zone -->
    <div class="bg-red-50 border border-red-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-red-800 mb-4">Danger Zone</h3>
        <p class="text-sm text-red-700 mb-4">
            Deleting this user will permanently remove all associated system configurations, proxy containers, and VPN settings.
            This action cannot be undone.
        </p>
        <button id="deleteUserBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2">
            Delete User
        </button>
    </div>
</div>

<!-- Test Connection Modal -->
<div id="testModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg font-medium text-gray-900 mb-4" id="testModalTitle">Testing Connection...</h3>
            <div id="testModalContent" class="text-sm text-gray-600">
                <div class="flex items-center">
                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>
                    Performing connection test...
                </div>
            </div>
            <div class="flex justify-end mt-4">
                <button id="closeTestModal" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// User detail specific JavaScript is handled in dashboard.js
</script>
{% endblock %}
